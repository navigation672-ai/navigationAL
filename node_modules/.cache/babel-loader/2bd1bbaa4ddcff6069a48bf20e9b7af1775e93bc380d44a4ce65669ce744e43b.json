{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useCallback, useEffect, useRef, useState } from 'react';\nconst SESSION_KEY = 'app_session';\nconst SESSION_TTL = 30 * 60 * 1000; // 30 minutes\n\nfunction getStoredSession() {\n  try {\n    const raw = localStorage.getItem(SESSION_KEY);\n    if (!raw) return null;\n    const obj = JSON.parse(raw);\n    if (!obj || typeof obj.sessionStart !== 'number') return null;\n    return obj;\n  } catch {\n    return null;\n  }\n}\nfunction cameFromQR() {\n  const params = new URLSearchParams(window.location.search);\n  return params.get('qr') === '1';\n}\nexport default function useSession() {\n  _s();\n  const [isSessionActive, setIsSessionActive] = useState(false);\n  const [isExpired, setIsExpired] = useState(false);\n  const [remainingTime, setRemainingTime] = useState(0);\n  const timeoutRef = useRef(null);\n  const intervalRef = useRef(null);\n  const clearTimers = () => {\n    if (timeoutRef.current) clearTimeout(timeoutRef.current);\n    if (intervalRef.current) clearInterval(intervalRef.current);\n  };\n  const expireNow = useCallback(() => {\n    localStorage.removeItem(SESSION_KEY);\n    clearTimers();\n    setIsSessionActive(false);\n    setIsExpired(true);\n    setRemainingTime(0);\n  }, []);\n  const startSession = useCallback(() => {\n    localStorage.setItem(SESSION_KEY, JSON.stringify({\n      sessionStart: Date.now()\n    }));\n\n    // remove ?qr=1 from URL so refresh can't restart session\n    window.history.replaceState({}, '', window.location.pathname);\n    setIsSessionActive(true);\n    setIsExpired(false);\n    setRemainingTime(SESSION_TTL);\n    clearTimers();\n    timeoutRef.current = setTimeout(expireNow, SESSION_TTL);\n    intervalRef.current = setInterval(() => {\n      const s = getStoredSession();\n      if (!s) return expireNow();\n      const rem = Math.max(0, SESSION_TTL - (Date.now() - s.sessionStart));\n      setRemainingTime(rem);\n    }, 1000);\n  }, [expireNow]);\n  useEffect(() => {\n    const sess = getStoredSession();\n\n    // ‚úÖ Existing valid session\n    if (sess) {\n      const elapsed = Date.now() - sess.sessionStart;\n      if (elapsed >= SESSION_TTL) {\n        expireNow();\n        return;\n      }\n      const remaining = SESSION_TTL - elapsed;\n      setIsSessionActive(true);\n      setIsExpired(false);\n      setRemainingTime(remaining);\n      timeoutRef.current = setTimeout(expireNow, remaining);\n      intervalRef.current = setInterval(() => {\n        const rem = Math.max(0, SESSION_TTL - (Date.now() - sess.sessionStart));\n        setRemainingTime(rem);\n      }, 1000);\n      return clearTimers;\n    }\n\n    // ‚ùå No session ‚Üí only start if QR scanned\n    if (cameFromQR()) {\n      startSession();\n      return;\n    }\n\n    // üîí Locked state\n    setIsSessionActive(false);\n    setIsExpired(true);\n    setRemainingTime(0);\n  }, [expireNow, startSession]);\n  return {\n    isSessionActive,\n    isExpired,\n    remainingTime\n  };\n}\n_s(useSession, \"TcjrUothQLR27XMwjPLC+GwKqQM=\");","map":{"version":3,"names":["useCallback","useEffect","useRef","useState","SESSION_KEY","SESSION_TTL","getStoredSession","raw","localStorage","getItem","obj","JSON","parse","sessionStart","cameFromQR","params","URLSearchParams","window","location","search","get","useSession","_s","isSessionActive","setIsSessionActive","isExpired","setIsExpired","remainingTime","setRemainingTime","timeoutRef","intervalRef","clearTimers","current","clearTimeout","clearInterval","expireNow","removeItem","startSession","setItem","stringify","Date","now","history","replaceState","pathname","setTimeout","setInterval","s","rem","Math","max","sess","elapsed","remaining"],"sources":["D:/navigationAl-main/src/hooks/useSession.js"],"sourcesContent":["import { useCallback, useEffect, useRef, useState } from 'react';\n\nconst SESSION_KEY = 'app_session';\nconst SESSION_TTL = 30 * 60 * 1000; // 30 minutes\n\nfunction getStoredSession() {\n  try {\n    const raw = localStorage.getItem(SESSION_KEY);\n    if (!raw) return null;\n    const obj = JSON.parse(raw);\n    if (!obj || typeof obj.sessionStart !== 'number') return null;\n    return obj;\n  } catch {\n    return null;\n  }\n}\n\nfunction cameFromQR() {\n  const params = new URLSearchParams(window.location.search);\n  return params.get('qr') === '1';\n}\n\nexport default function useSession() {\n  const [isSessionActive, setIsSessionActive] = useState(false);\n  const [isExpired, setIsExpired] = useState(false);\n  const [remainingTime, setRemainingTime] = useState(0);\n\n  const timeoutRef = useRef(null);\n  const intervalRef = useRef(null);\n\n  const clearTimers = () => {\n    if (timeoutRef.current) clearTimeout(timeoutRef.current);\n    if (intervalRef.current) clearInterval(intervalRef.current);\n  };\n\n  const expireNow = useCallback(() => {\n    localStorage.removeItem(SESSION_KEY);\n    clearTimers();\n    setIsSessionActive(false);\n    setIsExpired(true);\n    setRemainingTime(0);\n  }, []);\n\n  const startSession = useCallback(() => {\n    localStorage.setItem(\n      SESSION_KEY,\n      JSON.stringify({ sessionStart: Date.now() })\n    );\n\n    // remove ?qr=1 from URL so refresh can't restart session\n    window.history.replaceState({}, '', window.location.pathname);\n\n    setIsSessionActive(true);\n    setIsExpired(false);\n    setRemainingTime(SESSION_TTL);\n\n    clearTimers();\n\n    timeoutRef.current = setTimeout(expireNow, SESSION_TTL);\n\n    intervalRef.current = setInterval(() => {\n      const s = getStoredSession();\n      if (!s) return expireNow();\n\n      const rem = Math.max(\n        0,\n        SESSION_TTL - (Date.now() - s.sessionStart)\n      );\n      setRemainingTime(rem);\n    }, 1000);\n  }, [expireNow]);\n\n  useEffect(() => {\n    const sess = getStoredSession();\n\n    // ‚úÖ Existing valid session\n    if (sess) {\n      const elapsed = Date.now() - sess.sessionStart;\n      if (elapsed >= SESSION_TTL) {\n        expireNow();\n        return;\n      }\n\n      const remaining = SESSION_TTL - elapsed;\n      setIsSessionActive(true);\n      setIsExpired(false);\n      setRemainingTime(remaining);\n\n      timeoutRef.current = setTimeout(expireNow, remaining);\n      intervalRef.current = setInterval(() => {\n        const rem = Math.max(\n          0,\n          SESSION_TTL - (Date.now() - sess.sessionStart)\n        );\n        setRemainingTime(rem);\n      }, 1000);\n\n      return clearTimers;\n    }\n\n    // ‚ùå No session ‚Üí only start if QR scanned\n    if (cameFromQR()) {\n      startSession();\n      return;\n    }\n\n    // üîí Locked state\n    setIsSessionActive(false);\n    setIsExpired(true);\n    setRemainingTime(0);\n  }, [expireNow, startSession]);\n\n  return {\n    isSessionActive,\n    isExpired,\n    remainingTime\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
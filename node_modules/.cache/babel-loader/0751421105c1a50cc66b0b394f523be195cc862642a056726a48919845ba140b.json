{"ast":null,"code":"import{useCallback,useEffect,useRef,useState}from'react';const SESSION_KEY='app_session';const SESSION_TTL=30*60*1000;// 30 minutes\nfunction getStoredSession(){try{const raw=localStorage.getItem(SESSION_KEY);if(!raw)return null;const obj=JSON.parse(raw);if(!obj||typeof obj.sessionStart!=='number')return null;return obj;}catch(_unused){return null;}}function cameFromQR(){const params=new URLSearchParams(window.location.search);return params.get('qr')==='1';}export default function useSession(){const[isSessionActive,setIsSessionActive]=useState(false);const[isExpired,setIsExpired]=useState(false);const[remainingTime,setRemainingTime]=useState(0);const timeoutRef=useRef(null);const intervalRef=useRef(null);const clearTimers=()=>{if(timeoutRef.current)clearTimeout(timeoutRef.current);if(intervalRef.current)clearInterval(intervalRef.current);};const expireNow=useCallback(()=>{localStorage.removeItem(SESSION_KEY);clearTimers();setIsSessionActive(false);setIsExpired(true);setRemainingTime(0);},[]);const startSession=useCallback(()=>{localStorage.setItem(SESSION_KEY,JSON.stringify({sessionStart:Date.now()}));// remove ?qr=1 from URL so refresh can't restart session\nwindow.history.replaceState({},'',window.location.pathname);setIsSessionActive(true);setIsExpired(false);setRemainingTime(SESSION_TTL);clearTimers();timeoutRef.current=setTimeout(expireNow,SESSION_TTL);intervalRef.current=setInterval(()=>{const s=getStoredSession();if(!s)return expireNow();const rem=Math.max(0,SESSION_TTL-(Date.now()-s.sessionStart));setRemainingTime(rem);},1000);},[expireNow]);useEffect(()=>{const sess=getStoredSession();// ‚úÖ Existing valid session\nif(sess){const elapsed=Date.now()-sess.sessionStart;if(elapsed>=SESSION_TTL){expireNow();return;}const remaining=SESSION_TTL-elapsed;setIsSessionActive(true);setIsExpired(false);setRemainingTime(remaining);timeoutRef.current=setTimeout(expireNow,remaining);intervalRef.current=setInterval(()=>{const rem=Math.max(0,SESSION_TTL-(Date.now()-sess.sessionStart));setRemainingTime(rem);},1000);return clearTimers;}// ‚ùå No session ‚Üí only start if QR scanned\nif(cameFromQR()){startSession();return;}// üîí Locked state\nsetIsSessionActive(false);setIsExpired(true);setRemainingTime(0);},[expireNow,startSession]);return{isSessionActive,isExpired,remainingTime};}","map":{"version":3,"names":["useCallback","useEffect","useRef","useState","SESSION_KEY","SESSION_TTL","getStoredSession","raw","localStorage","getItem","obj","JSON","parse","sessionStart","_unused","cameFromQR","params","URLSearchParams","window","location","search","get","useSession","isSessionActive","setIsSessionActive","isExpired","setIsExpired","remainingTime","setRemainingTime","timeoutRef","intervalRef","clearTimers","current","clearTimeout","clearInterval","expireNow","removeItem","startSession","setItem","stringify","Date","now","history","replaceState","pathname","setTimeout","setInterval","s","rem","Math","max","sess","elapsed","remaining"],"sources":["D:/navigationAl-main/src/hooks/useSession.js"],"sourcesContent":["import { useCallback, useEffect, useRef, useState } from 'react';\n\nconst SESSION_KEY = 'app_session';\nconst SESSION_TTL = 30 * 60 * 1000; // 30 minutes\n\nfunction getStoredSession() {\n  try {\n    const raw = localStorage.getItem(SESSION_KEY);\n    if (!raw) return null;\n    const obj = JSON.parse(raw);\n    if (!obj || typeof obj.sessionStart !== 'number') return null;\n    return obj;\n  } catch {\n    return null;\n  }\n}\n\nfunction cameFromQR() {\n  const params = new URLSearchParams(window.location.search);\n  return params.get('qr') === '1';\n}\n\nexport default function useSession() {\n  const [isSessionActive, setIsSessionActive] = useState(false);\n  const [isExpired, setIsExpired] = useState(false);\n  const [remainingTime, setRemainingTime] = useState(0);\n\n  const timeoutRef = useRef(null);\n  const intervalRef = useRef(null);\n\n  const clearTimers = () => {\n    if (timeoutRef.current) clearTimeout(timeoutRef.current);\n    if (intervalRef.current) clearInterval(intervalRef.current);\n  };\n\n  const expireNow = useCallback(() => {\n    localStorage.removeItem(SESSION_KEY);\n    clearTimers();\n    setIsSessionActive(false);\n    setIsExpired(true);\n    setRemainingTime(0);\n  }, []);\n\n  const startSession = useCallback(() => {\n    localStorage.setItem(\n      SESSION_KEY,\n      JSON.stringify({ sessionStart: Date.now() })\n    );\n\n    // remove ?qr=1 from URL so refresh can't restart session\n    window.history.replaceState({}, '', window.location.pathname);\n\n    setIsSessionActive(true);\n    setIsExpired(false);\n    setRemainingTime(SESSION_TTL);\n\n    clearTimers();\n\n    timeoutRef.current = setTimeout(expireNow, SESSION_TTL);\n\n    intervalRef.current = setInterval(() => {\n      const s = getStoredSession();\n      if (!s) return expireNow();\n\n      const rem = Math.max(\n        0,\n        SESSION_TTL - (Date.now() - s.sessionStart)\n      );\n      setRemainingTime(rem);\n    }, 1000);\n  }, [expireNow]);\n\n  useEffect(() => {\n    const sess = getStoredSession();\n\n    // ‚úÖ Existing valid session\n    if (sess) {\n      const elapsed = Date.now() - sess.sessionStart;\n      if (elapsed >= SESSION_TTL) {\n        expireNow();\n        return;\n      }\n\n      const remaining = SESSION_TTL - elapsed;\n      setIsSessionActive(true);\n      setIsExpired(false);\n      setRemainingTime(remaining);\n\n      timeoutRef.current = setTimeout(expireNow, remaining);\n      intervalRef.current = setInterval(() => {\n        const rem = Math.max(\n          0,\n          SESSION_TTL - (Date.now() - sess.sessionStart)\n        );\n        setRemainingTime(rem);\n      }, 1000);\n\n      return clearTimers;\n    }\n\n    // ‚ùå No session ‚Üí only start if QR scanned\n    if (cameFromQR()) {\n      startSession();\n      return;\n    }\n\n    // üîí Locked state\n    setIsSessionActive(false);\n    setIsExpired(true);\n    setRemainingTime(0);\n  }, [expireNow, startSession]);\n\n  return {\n    isSessionActive,\n    isExpired,\n    remainingTime\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}